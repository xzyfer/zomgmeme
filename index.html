<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/public/stylesheets/bootstrap.css">
<link rel="stylesheet" href="/public/stylesheets/bootstrap-responsive.css">
<link rel="stylesheet" href="/public/stylesheets/style.css">

</style>
<script src=jquery.js></script>
<script src=test.js></script>
<script>
$(function() {

  var imgPath = '/public/images/characters/{{character}}.png',
      $top = $('#top'),
      $bottom = $('#bottom'),
      trigger = function() { $(document).trigger('update'); },
      propCanvas = function() { $(document).trigger('prop-canvas'); },
      isReady = false,
      waiting = false,
      maxWidth = document.width,
      $cvs, img;

  [
    'All of the things',
    'Baby godfather',
    'Bear Grylls',
    'Bitch please',
    'Bitch please (colour)',
    'Chuck Norris',
    'Condescending Wonka',
    'Conspiracy Keanu',
    'First world problems',
    'Forever alone',
    'Good guy Greg',
    'Great scott',
    'Hipster barista',
    'I hate',
    'Me gusta',
    'My name is Earl',
    'Not bad Obamas',
    'Not sure if',
    'Okay',
    'One does not simply',
    'Pedo Bear',
    'Philosoraptor',
    'Rage fu',
    'Ridiculasly photogenic guy',
    'Science cat',
    'Science dog',
    'Scumbag Steve',
    'Skeptical thrid world child',
    'Socially awkward penguin',
    'Success kid',
    'The most interesting guy in the world',
    'Trollface',
    'What if I told you',
    'Whyyyy',
  ].forEach(function(c) {
    $('#lememes').append($('<option>', { text: c, value: c.toLowerCase().replace(/\s/g, '_').replace(/[^\w_]/g, '') }));
  });

  $(document).on('update', function() {
    if(!isReady) {
      if(waiting) return;
      waiting = true;
      setTimeout(trigger, 30);
      return;
    }
    zomgmeme($cvs, img, $top.val(), $bottom.val());
    isReady = true;
    waiting = false;
  });

  $('#lememes').on('change', function() {
    if(img) $(img).remove();

    isReady = false;

    var $img = $('<img />')
      .attr('src', imgPath.replace(/\{\{.*?\}\}/, $(this).val()))
      .load(function() { img = this; propCanvas() });
  }).trigger('change');

  $('textarea').on('keyup', function() {
    trigger();
  });

  $(document).on('prop-canvas', function() {
    if(img.width > maxWidth) {
      img.height = maxWidth / (img.width/img.height);
      img.width = maxWidth;
    }

    $('canvas').remove();
    $cvs = $('<canvas width='+img.width+' height='+img.height+' />');

    $('#canvas-wrapper').prepend($cvs);
    isReady = true;
    trigger();
  });
});
</script>
<h1 class="text-center"><img id=logo src=/public/images/zomg-logo.jpg />ZOMG! Meme Generator</h1>
<!-- <canvas width=550 height=360></canvas> -->
<div class=row><div class="span8 offset2 text-center"><div class=form-horizontal>
  <label class=control-label for=inputCharacter>Select character</label>
  <div class=controls><select id=lememes></select></div>
</div></div></div>

<div class=row><div class=span12>
<div  class=text-center id=canvas-wrapper></div>
</div></div>

<div class=row>
  <div class="span5 offset1">
    <label class=control-label for=top>Top Line</label>
    <textarea class=input-xlarge id=top>Make memes of</textarea>
  </div><div class=span5>
    <label class=control-label for=bottom>Bottom Line</label>
    <textarea class=input-xlarge id=bottom>All the things</textarea>
  </div>
</div>
